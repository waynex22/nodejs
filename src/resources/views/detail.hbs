<section class="text-gray-700 body-font shadow-[rgba(0,_0,_0,_0.2)_0px_60px_40px_-7px] overflow-hidden bg-white">
    <div class="container px-5 py-24 mx-auto">
        <div class="lg:w-4/5 mx-auto flex flex-wrap">
            <img alt="{{book.title}}" class="lg:w-1/2 w-full object-cover object-center rounded border border-gray-200"
                src="/uploads/{{book.image}}">
            <div class="lg:w-1/2 w-full lg:pl-10 lg:py-6 mt-6 lg:mt-0">
                <h2 class="text-sm title-font text-gray-500 tracking-widest">XTRABOOK</h2>
                <h1 class="text-gray-900 text-3xl title-font font-medium mb-1">{{book.title}}</h1>
                <div class="flex items-start justify-start mb-5">
                    {{#each (sequenceAg book.average_score)}}
                    <svg class="w-4 h-4 text-yellow-300 mr-1" aria-hidden="true" xmlns="http://www.w3.org/2000/svg"
                        fill="currentColor" viewBox="0 0 22 20">
                        <path
                            d="M20.924 7.625a1.523 1.523 0 0 0-1.238-1.044l-5.051-.734-2.259-4.577a1.534 1.534 0 0 0-2.752 0L7.365 5.847l-5.051.734A1.535 1.535 0 0 0 1.463 9.2l3.656 3.563-.863 5.031a1.532 1.532 0 0 0 2.226 1.616L11 17.033l4.518 2.375a1.534 1.534 0 0 0 2.226-1.617l-.863-5.03L20.537 9.2a1.523 1.523 0 0 0 .387-1.575Z" />
                    </svg>
                    {{/each}}
                    <p class="ml-2 text-sm font-medium text-gray-500 dark:text-gray-400">({{book.review_count}})</p>
                </div>
                <div class="mt-4">
                    <h2 class="text-xl my-4">Thông tin sách</h2>
                    <p class="leading-relaxed">
                        Tác giả: {{book.author}}
                    </p>
                    <p class="leading-relaxed my-4">
                        Năm xuất bản: {{book.year}}
                    </p>
                    <p class="leading-relaxed my-4">
                        Mã Hàng(ISBN): {{book.isbn}}
                    </p>
                    <p class="leading-relaxed my-4 flex items-center">
                        Điểm trung bình: {{book.average_score}}
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5"
                            stroke="currentColor" class="w-5 h-5 ml-2 text-red-600">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M4.5 12.75l6 6 9-13.5" />
                        </svg>
                    </p>
                </div>
                <div class="flex mt-8 items-center justify-start">
                    <lable class="title-font font-medium text-md text-gray-900">Thêm vào danh sách yêu thích</lable>
                    <button
                        class="rounded-full w-10 h-10 bg-gray-200 hover:bg-red-300 p-0 border-0 inline-flex items-center justify-center text-gray-500 ml-4">
                        <svg fill="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            class="w-5 h-5 text-red-600" viewBox="0 0 24 24">
                            <path
                                d="M20.84 4.61a5.5 5.5 0 00-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 00-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 000-7.78z">
                            </path>
                        </svg>
                    </button>
                </div>
            </div>
        </div>
    </div>
     <div class="mt-4 mx-20">
        <h2 class="">Mô tả:</h2>
        <p class="leading-relaxed text-gray-500 my-4">{{book.description}}</p>
        </div>
</section>

<section class="bg-white shadow-[rgba(0,_0,_0,_0.2)_0px_60px_40px_-7px] py-8 lg:py-16">
    <div class="max-w-2xl mx-auto px-4">
        <div class="flex justify-between items-center mb-6">
            <h2 class="text-lg lg:text-2xl font-bold text-gray-900 ">Đánh giá ({{book.review_count}})</h2>
        </div>
        {{#if user}}
        <form method="post" action="/book/post-comment" class="mb-6">
            <ul class="my-1 flex list-none gap-1 mb-4 p-0" data-te-rating-init>
                <li>
                    <lable for="rate" class="text-[#673ab7] [&>svg]:h-5 [&>svg]:w-5" data-te-rating-icon-ref>
                        <svg xmlns="http://www.w3.org/2000/svg" name="rate" id="rate" value="1" fill="none"
                            viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round"
                                d="M11.48 3.499a.562.562 0 011.04 0l2.125 5.111a.563.563 0 00.475.345l5.518.442c.499.04.701.663.321.988l-4.204 3.602a.563.563 0 00-.182.557l1.285 5.385a.562.562 0 01-.84.61l-4.725-2.885a.563.563 0 00-.586 0L6.982 20.54a.562.562 0 01-.84-.61l1.285-5.386a.562.562 0 00-.182-.557l-4.204-3.602a.563.563 0 01.321-.988l5.518-.442a.563.563 0 00.475-.345L11.48 3.5z" />
                        </svg>
                    </lable>
                </li>
                <li>
                    <lable for="rate" class="text-[#3f51b5] [&>svg]:h-5 [&>svg]:w-5" data-te-rating-icon-ref>
                        <svg xmlns="http://www.w3.org/2000/svg" value="2" name="rate" id="rate" fill="none"
                            viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round"
                                d="M11.48 3.499a.562.562 0 011.04 0l2.125 5.111a.563.563 0 00.475.345l5.518.442c.499.04.701.663.321.988l-4.204 3.602a.563.563 0 00-.182.557l1.285 5.385a.562.562 0 01-.84.61l-4.725-2.885a.563.563 0 00-.586 0L6.982 20.54a.562.562 0 01-.84-.61l1.285-5.386a.562.562 0 00-.182-.557l-4.204-3.602a.563.563 0 01.321-.988l5.518-.442a.563.563 0 00.475-.345L11.48 3.5z" />
                        </svg>
                    </lable>
                </li>
                <li>
                    <lable for="rate" class="text-[#2196f3] [&>svg]:h-5 [&>svg]:w-5" data-te-rating-icon-ref>
                        <svg xmlns="http://www.w3.org/2000/svg" name="rate" id="rate" value="3" fill="none"
                            viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round"
                                d="M11.48 3.499a.562.562 0 011.04 0l2.125 5.111a.563.563 0 00.475.345l5.518.442c.499.04.701.663.321.988l-4.204 3.602a.563.563 0 00-.182.557l1.285 5.385a.562.562 0 01-.84.61l-4.725-2.885a.563.563 0 00-.586 0L6.982 20.54a.562.562 0 01-.84-.61l1.285-5.386a.562.562 0 00-.182-.557l-4.204-3.602a.563.563 0 01.321-.988l5.518-.442a.563.563 0 00.475-.345L11.48 3.5z" />
                        </svg>
                    </lable>
                </li>
                <li>
                    <lable for="rate" class="text-[#03a9f4] [&>svg]:h-5 [&>svg]:w-5" data-te-rating-icon-ref>
                        <svg xmlns="http://www.w3.org/2000/svg" name="rate" id="rate" value="4" fill="none"
                            viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round"
                                d="M11.48 3.499a.562.562 0 011.04 0l2.125 5.111a.563.563 0 00.475.345l5.518.442c.499.04.701.663.321.988l-4.204 3.602a.563.563 0 00-.182.557l1.285 5.385a.562.562 0 01-.84.61l-4.725-2.885a.563.563 0 00-.586 0L6.982 20.54a.562.562 0 01-.84-.61l1.285-5.386a.562.562 0 00-.182-.557l-4.204-3.602a.563.563 0 01.321-.988l5.518-.442a.563.563 0 00.475-.345L11.48 3.5z" />
                        </svg>
                    </lable>
                </li>
                <li>
                    <lable for="rate" class="text-[#00bcd4] [&>svg]:h-5 [&>svg]:w-5" data-te-rating-icon-ref>
                        <svg xmlns="http://www.w3.org/2000/svg" value="5" name="rate" id="rate" fill="none"
                            viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round"
                                d="M11.48 3.499a.562.562 0 011.04 0l2.125 5.111a.563.563 0 00.475.345l5.518.442c.499.04.701.663.321.988l-4.204 3.602a.563.563 0 00-.182.557l1.285 5.385a.562.562 0 01-.84.61l-4.725-2.885a.563.563 0 00-.586 0L6.982 20.54a.562.562 0 01-.84-.61l1.285-5.386a.562.562 0 00-.182-.557l-4.204-3.602a.563.563 0 01.321-.988l5.518-.442a.563.563 0 00.475-.345L11.48 3.5z" />
                        </svg>
                    </lable>
                </li>
            </ul>
            <input type="hidden" id="id_book" name="id_book" value="{{book._id}}">
            <input type="hidden" id="hiddenRatingInput" name="rating" value="">
            <input type="hidden" id="id_account" name="id_account" value="{{user.id}}">
            <div class="py-2 px-4 mb-4 bg-white rounded-lg rounded-t-lg border border-gray-200  dark:border-gray-700">
                <label for="content" class="sr-only">Bình luận của bạn</label>
                <textarea id="content" name="content" rows="6"
                    class="px-0 w-full text-sm text-gray-900 border-0 focus:ring-0 focus:outline-none  dark:placeholder-gray-400 "
                    placeholder="Viết ý kiến của bạn về cuốn sách này..." required></textarea>
            </div>
            <button type="submit"
                class="inline-flex items-center py-2.5 px-4 text-xs font-medium text-center text-white bg-red-600 rounded-lg focus:ring-4 focus:ring-primary-200  hover:bg-primary-800">
                Bình luận
            </button>
        </form>
        {{else}}
        <p>Đăng nhập để đánh giá sản phẩm
        </p>
        {{/if}}
        {{#if error}}
        <h2 class="text-red-600">{{error}}</h2>    
        {{/if}}
        {{#each comments}}
        <article class="p-6 text-base bg-white rounded-lg ">
            <div class="flex mb-4 mt-4">
                {{#each (sequence rating)}}
                <svg class="w-4 h-4 text-yellow-300 mr-1" aria-hidden="true" xmlns="http://www.w3.org/2000/svg"
                    fill="currentColor" viewBox="0 0 22 20">
                    <path
                        d="M20.924 7.625a1.523 1.523 0 0 0-1.238-1.044l-5.051-.734-2.259-4.577a1.534 1.534 0 0 0-2.752 0L7.365 5.847l-5.051.734A1.535 1.535 0 0 0 1.463 9.2l3.656 3.563-.863 5.031a1.532 1.532 0 0 0 2.226 1.616L11 17.033l4.518 2.375a1.534 1.534 0 0 0 2.226-1.617l-.863-5.03L20.537 9.2a1.523 1.523 0 0 0 .387-1.575Z" />
                </svg>
                {{/each}}
            </div>

            <footer class="flex justify-between items-center mb-2">
                <div class="flex items-center">
                    <p class="inline-flex items-center mr-3 text-sm text-gray-900  font-semibold"><img
                            class="mr-2 w-6 h-6 rounded-full"
                            src="https://flowbite.com/docs/images/people/profile-picture-2.jpg"
                            alt="Michael Gough">{{id_account.name}}</p>
                    <p class="text-sm text-gray-600 dark:text-gray-400">
                        <time pubdate datetime="{{createdAt}}" title="{{createdAt}}">{{formatDate createdAt}}</time>
                    </p>
                </div>
            </footer>
            <p class="text-gray-500 dark:text-gray-400">{{content}}</p>
        </article>
        {{/each}}
    </div>
    <div class="bg-white  rounded-lg w-full h-fit overflow-hidden mt-10 ">
        <div class="flex justify-center items-center">
            <h1
                class="text-2xl p-4 text-center font-bold from-red-600 via-orange-500 to-orange-300 bg-gradient-to-r bg-clip-text text-transparent">
                Có thể bạn quan tâm </h1>
        </div>
        <hr
            class="my-12 h-0.5 border-t-0 bg-gradient-to-r from-indigo-500 via-purple-500 to-pink-500 opacity-100 dark:opacity-50" />
        <div class="grid grid-cols-6 gap-6 mx-auto" data-te-animation-init data-te-animation-start="onScroll"
            data-te-animation-reset="true" data-te-animation="[slide-in-left_1s_ease-in-out]">
            {{#each books}}
            <div class=" mt-4 mx-4 col-span-1">
                <a href="/book/{{this._id}}" class=" mt-4 bg-white  rounded-lg  md:flex-row md:max-w-xl">
                    <img class="object-cover object-center w-full transition duration-300 ease-in-out hover:scale-110 rounded-t-lg h-96 md:h-auto md:w-48 md:rounded-none md:rounded-l-lg"
                        src="/uploads/{{this.image}}" alt="{{this.title}}">
                    <div class="p-4">
                        <h5 class="mb-2 text-lg font-bold-light tracking-tight text-gray-600 h-12">{{this.title}}
                        </h5>
                        <div class="flex items-start justify-start mb-5">
                            {{#each (sequenceAg this.average_score)}}
                            <svg class="w-4 h-4 text-yellow-300 mr-1" aria-hidden="true"
                                xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 22 20">
                                <path
                                    d="M20.924 7.625a1.523 1.523 0 0 0-1.238-1.044l-5.051-.734-2.259-4.577a1.534 1.534 0 0 0-2.752 0L7.365 5.847l-5.051.734A1.535 1.535 0 0 0 1.463 9.2l3.656 3.563-.863 5.031a1.532 1.532 0 0 0 2.226 1.616L11 17.033l4.518 2.375a1.534 1.534 0 0 0 2.226-1.617l-.863-5.03L20.537 9.2a1.523 1.523 0 0 0 .387-1.575Z" />
                            </svg>
                            {{/each}}
                            <p class="ml-2 text-sm font-medium text-gray-500 dark:text-gray-400">
                                ({{this.review_count}})</p>
                        </div>
                    </div>
                </a>
            </div>
            {{/each}}
        </div>
    </div>
</section>
<script>
    document.addEventListener('DOMContentLoaded', function () {
        const ratingLabels = document.querySelectorAll('[data-te-rating-icon-ref]');
        ratingLabels.forEach(function (label) {
            label.addEventListener('click', function () {
                const ratingValue = label.querySelector('svg').getAttribute('value');
                const hiddenRatingInput = document.getElementById('hiddenRatingInput');
                if (hiddenRatingInput) {
                    hiddenRatingInput.value = ratingValue;
                }
            });
        });
    });
</script>